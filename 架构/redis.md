
## 单机模式

![](attachments/Pasted%20image%2020250408091731.png)

*优点*
- 部署简单
- 成本低，无备用节点
- 高性能，单机不需要同步数据，数据天然具有一致性

*缺点*
- 可靠性保证不是很好，单机宕机的风险
- 单机性能受限于CPU的处理能力

## 主从复制

![](attachments/Pasted%20image%2020250505230730.png)

Redis 的复制（Replication）功能允许用户根据一个 Redis 服务器来创建任意多个该服务器的复制品，其中被复制的服务器为主服务器（Master），而通过复制创建出来的复制品则为从服务器（Slave）。 只要主从服务器之间的网络连接正常，主服务器就会将写入自己的数据同步更新给从服务器，从而保证主从服务器的数据相同。
数据的复制是单向的，只能由主节点到从节点，简单理解就是从节点只支持读操作，不允许写操作。主要是读高并发的场景下用主从架构。主从模式需要考虑的问题是：当 Master 节点宕机，需要选举产生一个新的 Master 节点，从而保证服务的高可用性。

 *优点*
- Master/Slave 角色方便水平扩展，QPS 增加，增加 Slave 即可；
- 降低 Master 读压力，转交给 Slave 节点；
- 主节点宕机，从节点作为主节点的备份可以随时顶上继续提供服务；

*缺点*
- 可靠性保证不是很好，主节点故障便无法提供写入服务；
- 没有解决主节点写的压力；
- 数据冗余（为了高并发、高可用和高性能，一般是允许有冗余存在的）；
- 一旦主节点宕机，从节点晋升成主节点，需要修改应用方的主节点地址，还需要命令所有从节点去复制新的主节点，整个过程需要人工干预；
- 主节点的写能力受到单机的限制；
- 主节点的存储能力受到单机的限制。

## 哨兵模式
![](attachments/Pasted%20image%2020250505233124.png)

主从模式中，当主节点宕机之后，从节点是可以作为主节点顶上来继续提供服务，但是需要修改应用方的主节点地址，还需要命令所有从节点去复制新的主节点，整个过程需要人工干预。

于是，在 Redis 2.8 版本开始，引入了哨兵（Sentinel）这个概念，在**主从复制的基础**上，哨兵实现了**自动化故障恢复**。如上图所示，哨兵模式由两部分组成，哨兵节点和数据节点：

- 哨兵节点：哨兵节点是特殊的 Redis 节点，不存储数据；
- 数据节点：主节点和从节点都是数据节点。
### 定时任务

Sentinel 内部有 3 个定时任务，分别是：
- 每 1 秒每个 Sentinel 对其他 Sentinel 和 Redis 节点执行 `PING` 操作（监控），这是一个**心跳检测**，是失败判定的依据。
- 每 2 秒每个 Sentinel 通过 Master 节点的 channel 交换信息（Publish/Subscribe）；
- 每 10 秒每个 Sentinel 会对 Master 和 Slave 执行 `INFO` 命令，这个任务主要达到两个目的：
    - 发现 Slave 节点；
    - 确认主从关系。